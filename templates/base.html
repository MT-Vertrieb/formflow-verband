<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>{% block title %}FormFlow-Verband Thüringer Handball-Verband{% endblock %}</title>
  {% load static %}
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --sb-width-collapsed: 64px;
      --sb-width-expanded: 260px;
      --sb-bg: #0f141a;
      --sb-fg: #cfd8e3;
      --sb-fg-dim: #9aa7b5;
      --sb-border: rgba(255,255,255,.08);
      --sb-accent: #3b82f6;
      --content-bg: #f6f7fb;
    }

    html, body { height:100%; }
    body{
      margin:0;
      display:flex;
      min-height:100%;
      background:var(--content-bg);
      color:#111;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    /* ===== Sidebar ===== */
    .sidebar{
      position:sticky; top:0; left:0;
      height:100dvh;
      width:var(--sb-width-collapsed);
      background:var(--sb-bg);
      color:var(--sb-fg);
      border-right:1px solid var(--sb-border);
      transition: width .2s ease;
      z-index:1000;
      display:flex; flex-direction:column;
      overflow:hidden;
    }

    .sidebar .brand{
      display:flex; align-items:center; gap:.6rem;
      padding:.9rem .9rem;
      white-space:nowrap;
    }
    .sidebar .brand .logo{
      width:28px; height:28px; border-radius:6px;
      background:var(--sb-accent);
      box-shadow:0 0 0 2px rgba(59,130,246,.25) inset;
    }
    .sidebar .brand .title{
      opacity:0; transition:opacity .18s ease;
    }

    .sidebar nav{
      padding:.3rem .3rem 1rem;
      overflow-y:auto; overflow-x:hidden;
      scrollbar-width:thin;
    }
    .nav-section{
      color:var(--sb-fg-dim);
      font-size:.8rem;
      margin:.6rem .9rem .25rem;
      white-space:nowrap;
      opacity:.9;
    }
    .nav-item{
      display:flex; align-items:center; gap:.9rem;
      padding:.55rem .75rem;
      color:var(--sb-fg);
      text-decoration:none;
      border-radius:10px;
      margin:.15rem .35rem;
      white-space:nowrap;
    }
    .nav-item:hover{ background:rgba(255,255,255,.06); }
    .nav-item .icon{ width:20px; height:20px; flex:0 0 20px; opacity:.95; }
    .nav-item .label{ opacity:0; transition:opacity .18s ease; }

    /* ===== Content ===== */
    .content{
      flex:1 1 auto;
      min-width:0;
      padding:20px;
      max-width:100%;
      transition: margin-left .2s ease;
    }

    /* ===== Desktop: Hover klappt auf (kein Klick) ===== */
    @media (hover:hover) and (pointer:fine){
      .sidebar:hover{ width:var(--sb-width-expanded); }
      .sidebar:hover .brand .title,
      .sidebar:hover .nav-item .label{ opacity:1; }
    }

    /* ===== Mobile: Toggle (Tap) ===== */
    @media (max-width:1024px){
      body{ overflow-x:hidden; }
      .sidebar{
        position:fixed; transform:translateX(-100%);
        width:var(--sb-width-expanded);
        transition: transform .22s ease;
      }
      .sidebar.is-open{ transform:translateX(0); }
      .sidebar .brand .title,
      .sidebar .nav-item .label{ opacity:1; }

      .sidebar-toggle{
        position:fixed; left:.6rem; top:.6rem; z-index:1100;
        background:#fff; color:#111;
        border:1px solid #e5e7eb; border-radius:10px;
        padding:.5rem .65rem; line-height:1; cursor:pointer;
        box-shadow:0 2px 10px rgba(0,0,0,.06);
      }
      .backdrop{
        position:fixed; inset:0; z-index:900;
        background:rgba(0,0,0,.35);
        opacity:0; pointer-events:none; transition:opacity .22s ease;
      }
      .backdrop.is-open{ opacity:1; pointer-events:auto; }
    }

    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>

  <!-- Mobile Toggle + Backdrop (auf Desktop unsichtbar via CSS) -->
  <button class="sidebar-toggle" aria-controls="sidebar" aria-expanded="false">
    ☰ <span class="sr-only">Menü</span>
  </button>
  <div class="backdrop" id="sidebar-backdrop" aria-hidden="true"></div>

  <!-- ===== Sidebar ===== -->
  <aside id="sidebar" class="sidebar" role="navigation" aria-label="Hauptmenü">
    <div class="brand">
      <span class="logo" aria-hidden="true"></span>
      <span class="title">FormFlow THV</span>
    </div>

    <nav>
      <div class="nav-section">Allgemein</div>

      <!-- Dashboard -->
      <a class="nav-item" href="/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
        </svg>
        <span class="label">Dashboard</span>
      </a>

      <!-- Reisekostenantrag (Test) -->
      <a class="nav-item" href="/rka/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2l4 4-8 8-4-4 8-8zm-6 14h12v2H6v-2z"/>
        </svg>
        <span class="label">Reisekostenantrag (Test)</span>
      </a>

      <!-- Erstattung von Beträgen -->
      <a class="nav-item" href="/refunds/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M12 5v3H4v8h8v3l7-7-7-7z"/>
        </svg>
        <span class="label">Erstattung von Beträgen</span>
      </a>

      <!-- Belegprüfung -->
      <a class="nav-item" href="/invoicecheck/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M7 3h10a2 2 0 0 1 2 2v11l-5 5H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm6 14h3l-3 3v-3zM8 7h8v2H8V7zm0 4h8v2H8v-2z"/>
        </svg>
        <span class="label">Belegprüfung</span>
      </a>

      <!-- Haushaltsplan -->
      <a class="nav-item" href="/finance/haushaltsplan/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M4 4h16v2H4V4zm0 6h16v2H4v-2zm0 6h10v2H4v-2z"/>
        </svg>
        <span class="label">Haushaltsplan</span>
      </a>

      <!-- Persönlicher Bereich -->
      <a class="nav-item" href="/accounts/profile/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.33 0-8 2.17-8 5v1h16v-1c0-2.83-3.67-5-8-5Z"/></svg>
        <span class="label">Persönlicher Bereich</span>
      </a>

      <!-- CSV-Import (Haushaltsplan) -->
      <a class="nav-item" href="/finance/haushaltsplan/import/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 20h14v-2H5v2z"/>
        </svg>
        <span class="label">CSV-Import (Haushaltsplan)</span>
      </a>

      <!-- SMTP-Test -->
      <a class="nav-item" href="/settingsmgr/smtp-test/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 4H4c-1.1 0-2 .9-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5L4 8V6l8 5 8-5v2z"/>
        </svg>
        <span class="label">SMTP-Test</span>
      </a>

      <!-- Einstellungen -->
      <a class="nav-item" href="/settingsmgr/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.14 12.94a7.002 7.002 0 0 0 0-1.88l2.03-1.58a.5.5 0 0 0 .12-.66l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.007 7.007 0 0 0-1.63-.94l-.36-2.54a.5.5 0 0 0-.5-.42h-3.84a.5.5 0 0 0-.5.42l-.36 2.54c-.58.22-1.12.53-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L2.71 8.82a.5.5 0 0 0 .12.66l2.03 1.58c-.05.31-.08.63-.08.94s.03.63.08.94L2.83 14.5a.5.5 0 0 0-.12.66l1.92 3.32c.14.24.44.34.7.22l2.39-.96c.5.41 1.05.73 1.63.94l.36 2.54c.06.25.27.42.5.42h3.84c.24 0 .45-.17.5-.42l.36-2.54c.58-.22 1.12-.53 1.63-.94l2.39.96c.26.12.56.02.7-.22l1.92-3.32a.5.5 0 0 0-.12-.66l-2.03-1.56zM12 15.5A3.5 3.5 0 1 1 12 8a3.5 3.5 0 0 1 0 7.5z"/>
        </svg>
        <span class="label">⚙️ Einstellungen</span>
      </a>

      <!-- Admin -->
      <a class="nav-item" href="/admin/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.33 0-8 2.17-8 5v1h16v-1c0-2.83-3.67-5-8-5Z"/>
        </svg>
        <span class="label">🔐 Admin</span>
      </a>

      <!-- Logout -->
      <a class="nav-item" href="/accounts/logout/">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M16 13v-2H7V8l-5 4 5 4v-3h9zM20 3h-8v2h8v14h-8v2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/>
        </svg>
        <span class="label">🚪 Logout</span>
      </a>
    </nav>
  </aside>

  <!-- ===== Inhalt ===== -->
  <main id="content" class="content">
    {% block content %}{% endblock %}
  </main>

  <script>
    (function(){
      var sidebar = document.getElementById('sidebar');
      var toggle  = document.querySelector('.sidebar-toggle');
      var backdrop= document.getElementById('sidebar-backdrop');

      function isTouch(){
        return window.matchMedia('(hover: none), (pointer: coarse)').matches;
      }
      function open(){
        sidebar.classList.add('is-open');
        backdrop.classList.add('is-open');
        toggle && toggle.setAttribute('aria-expanded','true');
        sidebar.setAttribute('tabindex','-1');
        sidebar.focus({preventScroll:true});
      }
      function close(){
        sidebar.classList.remove('is-open');
        backdrop.classList.remove('is-open');
        toggle && toggle.setAttribute('aria-expanded','false');
        sidebar.removeAttribute('tabindex');
      }
      function toggleOpen(){
        if(sidebar.classList.contains('is-open')) close(); else open();
      }

      if(isTouch()){
        if(toggle){ toggle.addEventListener('click', toggleOpen); }
        if(backdrop){ backdrop.addEventListener('click', close); }
        document.addEventListener('keydown', function(e){ if(e.key === 'Escape') close(); });
        var startX=null;
        sidebar.addEventListener('touchstart', function(e){ startX = e.touches[0].clientX; }, {passive:true});
        sidebar.addEventListener('touchmove', function(e){
          if(startX==null) return;
          var dx = e.touches[0].clientX - startX;
          if(dx < -40){ close(); startX=null; }
        }, {passive:true});
      } else {
        if(toggle){ toggle.style.display='none'; }
        if(backdrop){ backdrop.style.display='none'; }
      }
    })();
  </script>
</body>
</html>
